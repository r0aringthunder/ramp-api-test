name: Run Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    env:
      DB_CONNECTION: mysql
      RAMP_CLIENT_ID: ${{ secrets.RAMP_CLIENT_ID }}
      RAMP_CLIENT_SECRET: ${{ secrets.RAMP_CLIENT_SECRET }}

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Set up PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: 8.2

    - name: Install dependencies
      run: composer install --prefer-dist --no-progress --no-suggest --ansi

    - name: Create environment file
      run: cp .env.example .env

    - name: Add the ramp configuration
      run: php artisan vendor:publish --tag=rampapi-config

    - name: Run tests
      run: php artisan test

    - uses: actions/github-script@v6
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: 'ðŸ‘‹ Thanks for reporting!'
          })
